name: Bluetooth App CI

on:
  push:
    branches: [ main ]

jobs:
  build-and-test:
    runs-on: ubuntu-22.04
    
    steps:
    - name: Code herunterladen
      uses: actions/checkout@v3
    
    - name: Setup ROS 2
      uses: ros-tooling/setup-ros@v0.5
      with:
        ros-distro: humble
    
    - name: App bauen
      run: |
        source /opt/ros/humble/setup.bash
        colcon build
        echo "✅ Build erfolgreich!"
    
    - name: App testen (simuliert)
      run: |
        source /opt/ros/humble/setup.bash
        source install/setup.bash
        timeout 10s ros2 run my_bt_test simple_scanner &
        sleep 3
        echo "✅ Test erfolgreich!"
    
    - name: Docker Image bauen
      run: |
        docker build -f docker/Dockerfile -t ghcr.io/${{ github.repository }}:latest .
        echo "✅ Docker Image erstellt!"
